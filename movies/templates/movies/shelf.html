{% extends "base.html" %}

{% block content %}

<h1>My Shelf üé¨</h1>
<p><a href="{% url 'home' %}">‚Üê Back to Search</a></p>

<style>
    .accordion {
        background: #eee;
        cursor: pointer;
        padding: 14px;
        width: 100%;
        text-align: left;
        border: none;
        outline: none;
        font-weight: bold;
        font-size: 18px;
        border-radius: 6px;
        margin-top: 12px;
        display: flex;
        align-items: center;
        position: relative;
        padding-left: 30px;
    }

    .accordion::before {
        content: "‚ñ∂";
        position: absolute;
        left: 10px;
        transition: transform 0.25s;
    }

    .accordion.active::before {
        transform: rotate(90deg);
    }

    .accordion.active {
        background: #dcdcdc;
    }

    .accordion:hover {
        background: #ddd;
    }

    .panel {
        padding: 10px 0;
        display: none;
    }

    .panel.show {
        display: block;
    }

    /* --- HORIZONTAL SCROLL ROWS (DRAGGABLE) --- */
    .movies-grid {
        display: flex;
        flex-wrap: nowrap;
        overflow-x: auto;
        gap: 25px;
        margin-top: 10px;
        padding-bottom: 14px;
        scroll-behavior: smooth;
        cursor: grab;
    }

    .movies-grid:active {
        cursor: grabbing;
    }

    /* Scrollbar styling */
    .movies-grid::-webkit-scrollbar {
        height: 8px;
    }
    .movies-grid::-webkit-scrollbar-track {
        background: #eee;
        border-radius: 10px;
    }
    .movies-grid::-webkit-scrollbar-thumb {
        background: #bbb;
        border-radius: 10px;
    }
    .movies-grid::-webkit-scrollbar-thumb:hover {
        background: #999;
    }

    .movie-card {
        width: 150px;
        text-align: center;
        display: flex;
        flex-direction: column;
        gap: 6px;
        flex-shrink: 0; /* prevents cards from shrinking */
    }

    .movie-card img {
        width: 150px;
        height: 225px;
        object-fit: cover;
        border-radius: 6px;
    }

    .movie-title {
        font-weight: bold;
        font-size: 14px;
        line-height: 1.2;
        height: 40px;
        overflow: hidden;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
    }

    button {
        padding: 6px 8px;
        border-radius: 4px;
        border: none;
        cursor: pointer;
        font-size: 13px;
    }

    button:hover {
        opacity: 0.85;
    }

    .remove-btn {
        background: #ffcccc;
    }
</style>

<!-- ---------- TO PUT AWAY ---------- -->
<button class="accordion active">üì¶ To Put Away</button>
<div class="panel show">
    {% if to_put_away %}
    <div class="movies-grid drag-scroll">
        {% for movie in to_put_away %}
        <div class="movie-card">
            <img src="{{ movie.poster_url|default:'https://via.placeholder.com/150x225?text=No+Poster' }}">
            <p class="movie-title">{{ movie.title }}</p>

            <form method="POST" action="{% url 'change_status' movie.id 'TO_WATCH' %}">
                {% csrf_token %}
                <button>üéØ Mark as To Watch</button>
            </form>

            <form method="POST" action="{% url 'change_status' movie.id 'WATCHED' %}">
                {% csrf_token %}
                <button>‚úÖ Mark as Watched</button>
            </form>

            <form method="POST" action="{% url 'remove_movie' movie.id %}">
                {% csrf_token %}
                <button class="remove-btn">üóë Remove</button>
            </form>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <p>No movies here.</p>
    {% endif %}
</div>

<!-- ---------- TO WATCH ---------- -->
<button class="accordion active">üéØ To Watch</button>
<div class="panel show">
    {% if to_watch %}
    <div class="movies-grid drag-scroll">
        {% for movie in to_watch %}
        <div class="movie-card">
            <img src="{{ movie.poster_url|default:'https://via.placeholder.com/150x225?text=No+Poster' }}">
            <p class="movie-title">{{ movie.title }}</p>

            <form method="POST" action="{% url 'change_status' movie.id 'WATCHED' %}">
                {% csrf_token %}
                <button>‚úÖ Mark as Watched</button>
            </form>

            <form method="POST" action="{% url 'remove_movie' movie.id %}">
                {% csrf_token %}
                <button class="remove-btn">üóë Remove</button>
            </form>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <p>Nothing in To Watch yet.</p>
    {% endif %}
</div>

<!-- ---------- WATCHED ---------- -->
<button class="accordion">üçø Watched</button>
<div class="panel">
    {% if watched %}
    <div class="movies-grid drag-scroll">
        {% for movie in watched %}
        <div class="movie-card">
            <img src="{{ movie.poster_url|default:'https://via.placeholder.com/150x225?text=No+Poster' }}">
            <p class="movie-title">{{ movie.title }}</p>

            <form method="POST" action="{% url 'change_status' movie.id 'TO_WATCH' %}">
                {% csrf_token %}
                <button>üéØ Mark as To Watch</button>
            </form>

            <form method="POST" action="{% url 'remove_movie' movie.id %}">
                {% csrf_token %}
                <button class="remove-btn">üóë Remove</button>
            </form>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <p>No watched movies yet.</p>
    {% endif %}
</div>

<script>
document.querySelectorAll(".accordion").forEach((acc) => {
    acc.addEventListener("click", () => {
        acc.classList.toggle("active");
        acc.nextElementSibling.classList.toggle("show");
    });
});

/* --- DRAG TO SCROLL --- */
document.querySelectorAll('.drag-scroll').forEach(container => {
    let isDown = false;
    let startX;
    let scrollLeft;

    container.addEventListener('mousedown', (e) => {
        isDown = true;
        container.classList.add('active');
        startX = e.pageX - container.offsetLeft;
        scrollLeft = container.scrollLeft;
    });

    container.addEventListener('mouseleave', () => isDown = false);
    container.addEventListener('mouseup', () => isDown = false);

    container.addEventListener('mousemove', (e) => {
        if(!isDown) return;
        e.preventDefault();
        const x = e.pageX - container.offsetLeft;
        const walk = (x - startX) * 1.5; // drag speed
        container.scrollLeft = scrollLeft - walk;
    });
});
</script>

{% endblock %}
