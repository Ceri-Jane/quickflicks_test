{% extends "base.html" %}
{% load static %}

{% block content %}

<div class="hero-box">
    <img src="{% static 'images/logo.png' %}" alt="QuickFlicks Logo" class="hero-logo">
    <p class="hero-subtitle">
        Explore thousands of movies with their details and ratings.<br>
        Sign up / Login to create your own shelves - keeping track of what you plan to watch and what you’ve already enjoyed.
    </p>

    {% if not user.is_authenticated %}
    <div class="hero-auth">
        <a href="{% url 'login' %}" class="btn-outline">Login</a>
        <a href="{% url 'signup' %}" class="btn-solid">Sign Up</a>
    </div>
    {% endif %}
</div>

<form method="GET" action="{% url 'home' %}" class="search-form">
    <input type="text" name="query" placeholder="Search for a movie..." value="{{ query }}">
    <button type="submit">Search</button>
</form>

<!-- ✅ Divider added below search form -->
<div class="page-divider"></div>

{% if movies %}
<h2 class="results-heading">Results</h2>

<div class="results-grid">

    {% for movie in movies %}
    <div class="movie-card">

        <div class="poster-area">
            <img 
                src="https://image.tmdb.org/t/p/w300{{ movie.poster_path|default:'' }}" 
                onerror="this.src='{% static 'images/movie-poster-unavailable.jpg' %}'" 
                alt="{{ movie.title }}">
        </div>

        <div class="movie-title">{{ movie.title }}</div>

        <!-- ✅ Rating + date wrapped inside consistent container -->
        <div class="movie-meta">
            {% if movie.vote_average %}
                <div class="movie-rating">⭐ {{ movie.vote_average }}/10</div>
            {% else %}
                <div class="movie-rating" style="visibility:hidden;">⭐</div>
            {% endif %}

            <div class="movie-date">{{ movie.release_date|default:"Unknown" }}</div>
        </div>

        <div class="movie-desc">
            {{ movie.overview|default:"No description available." }}
        </div>

        <div class="card-actions">
            {% if user.is_authenticated %}
                {% if movie.id|stringformat:"s" in user_movie_ids %}
                    <p class="in-shelf">✅ Already in Your Shelf</p>
                {% else %}
                <form method="POST" action="{% url 'add_to_shelf' %}">
                    {% csrf_token %}
                    <input type="hidden" name="movie_id" value="{{ movie.id }}">
                    <input type="hidden" name="title" value="{{ movie.title }}">
                    <input type="hidden" name="poster_path" value="{{ movie.poster_path }}">
                    <button class="btn-add">➕ Add to My Shelf</button>
                </form>
                {% endif %}
            {% else %}
                <p class="login-msg">
                    <a href="{% url 'login' %}">Log in</a> to add to your shelf.
                </p>
            {% endif %}
        </div>

    </div>
    {% endfor %}

</div>

{% elif query %}
<p class="no-results">No results found.</p>
{% endif %}

{% endblock %}
